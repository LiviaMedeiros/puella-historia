define("underscore backbone backboneCommon ajaxControl command text!template/top/TopPage.html text!css/top/Top.css js/top/RefundPoup text!template/announce/tempTakeover.html text!template/announce/tempNotice01.html text!template/announce/tempNotice02.html".split(" "),function(k,q,b,f,a,r,t,u,v,w,x){var m,d,n;b.displayedTop=!1;b.isSetUserData=!1;var z=function(){var e=function(){"TopPage"!==b.location?a.setWebView():($("#commandDiv").on("saveDataCallback",function(e,c){$("#commandDiv").off();b.displayedTop?
l():($("#commandDiv").on("nativeCallback",function(b,a){$("#commandDiv").off();l()}),a.startTop())}),a.checkQuestStored())},c=function(){$("#commandDiv").on("nativeCallback",function(a,c){$("#commandDiv").off();b.nativeDownload=!1;e()});b.displayedTop&&e()};b.nativeDownload=!0;if(162<(window.app_ver.split(".").join("")|0))if(b.displayedTop)c();else{var h=0;$("#configCallback").on("configCallback",function(d,g){$("#configCallback").off();b.nativeDownload=!1;h=g.movie?g.movie:0;$("#commandDiv").on("nativeCallback",
function(d,g){$("#commandDiv").off();0!==h?(c(),a.downloadFile("movie",{isVisibleCancel:!0,description:!0,note:!0})):(b.nativeDownload=!1,e())});a.downloadFile("common")});a.getDownloadConfig("configCallback")}else c(),b.displayedTop||a.downloadFile("common")},l=function(){d=f.getPageJson();b.setStyle(t);b.forceTapBlock({isBlock:!1});var e=function(){a.endTop();a.changeBg("web_common.ExportJson");a.setWebView();m=new A;b.globalMenuView&&b.globalMenuView.removeView();b.displayedTop=!0};k.has(d.user,
"id")?e():f.ajaxPost(b.linkList.createUser,null,function(c){b.responseSetStorage(c);localStorage.clear();$("#commandDiv").on("nativeCallback",function(b){$("#commandDiv").off();e()});a.configDataInitilize();window.isBrowser&&nativeCallback()})},A=q.View.extend({events:function(){var a={};a[b.cgti+" #transferBtn"]=this.transferPop;a[b.cgti+" #CharaListTopBtn"]=this.tapCharaListTopBtn;a[b.cgti+" #ArchiveBtn"]=this.tapArchiveBtn;a[b.cgti+" #TakeoverBtn"]=this.tapTakeoverBtn;a[b.cgti+" #RefundBtn"]=this.tapRefundBtn;
a[b.cgti+" .noticeText"]=this.tapNoticeText;return a},initialize:function(b){this.template=k.template(r);d.isServerActive=!0;this.createDom()},render:function(){window.isDebug&&k.findWhere(d.eventList,{eventType:"AJ2018"})&&(d.aj2018=!0);this.$el.html(this.template({model:d}));return this},createDom:function(){b.content.append(this.render().el);b.ready.hide();d&&d.gameUser&&!b.isSetUserData&&(B({pageJson:d,userData:n}),b.isSetUserData=!0)},tapCharaListTopBtn:function(a){a.preventDefault();b.isScrolled()||
(location.href="#/CharaListTop")},tapArchiveBtn:function(a){a.preventDefault();b.isScrolled()||(location.href="#/CollectionTop")},tapTakeoverBtn:function(a){a.preventDefault();b.isScrolled()||b.targetAnnounceOpen({announceData:{subject:"『魔法少女まどか☆マギカMagia Exedra』連携コードのご案内",startAt:"2024-7-31 00:00:00",text:v},dispCallback:function(){var a="";d.user&&d.user.personalId&&(a=d.user.personalId,$(".codeSec").removeClass("noDisp"),$("#takeOverCode").html(a),setTimeout(function(){b.scrollRefresh("scrollTextWrap",
"newsField",!0)},50))}})},tapNoticeText:function(a){a.preventDefault();if(!b.isScrolled()){var c={Notice01:w,Notice02:x}[a.currentTarget.dataset.id];a=$(a.currentTarget).text();b.targetAnnounceOpen({announceData:{subject:a,startAt:"2024-7-31 00:00:00",text:c}})}},tapRefundBtn:function(a){a.preventDefault();b.isScrolled()||u.checkIsRegistedRepaymentMail({pageJson:d})},transferPop:function(a){a&&a.preventDefault();if(!b.isScrolled()){var c,h,e=this,d=function(){e.transferPop()},f=!1,y=function(a){a.preventDefault();
b.isScrolled()||f||(f=!0,e.transferSubmit(c,h))};new b.PopupClass({title:"引き継ぎ・連携",content:b.doc.getElementById("transferInner").innerText,popupType:"typeE",exClass:"transferPop",closeBtnText:"キャンセル",decideBtnText:"OK"});b.nativeKeyBoard("transferId",15,1);b.nativeKeyBoard("transferPassword",15,1);b.doc.getElementById("popupArea").getElementsByClassName("decideBtn")[0].addEventListener(b.cgti,function(a){a&&a.preventDefault();b.isScrolled()||(c=b.doc.getElementById("transferPopup").getElementsByClassName("personalId")[0].value,
h=b.doc.getElementById("transferPopup").getElementsByClassName("password")[0].value,8>h.length||15<h.length?new b.PopupClass({title:"引き継ぎ・連携",content:"パスワードは8文字以上15文字以内です。",popupType:"typeC",closeBtnText:"OK"},null,null,d):(new b.PopupClass({title:"引き継ぎ・連携",content:"引き継ぎ・連携を行います。\x3cbr\x3eよろしいですか？",popupType:"typeE",closeBtnText:"キャンセル",decideBtnText:"OK",exClass:"transferCheck"},null,null,d),b.doc.getElementById("popupArea").getElementsByClassName("decideBtn")[0].addEventListener(b.cgti,y)))},!1)}},
transferSubmit:function(e,c){f.ajaxPost(b.linkList.userTransfer,{personalId:e,password:c},function(c){"error"!==c.resultCode&&(localStorage.setItem("MainQuestSelectPart",JSON.stringify({selectPart:1})),localStorage.setItem("SubQuestSelectPart",JSON.stringify({selectPart:1})),localStorage.removeItem("storedStoryIds"),localStorage.removeItem("storedVoiceTarget"),localStorage.removeItem("continuousPlayFlag"),new b.PopupClass({title:"引き継ぎ・連携",content:"引き継ぎ・連携が完了しました。",closeBtnText:"閉じる",popupType:"typeC"},
null,null,function(){b.displayedTop=!1;a.setUserJson();a.endTop();a.nativeReload("#/TopPage");window.isDebug&&window.isBrowser&&(location.href="#/TopPage",location.reload())}))})}}),C=function(b){var c=b.callback,e=!1;$("#commandDiv").on("nativeCallback",function(a,b){$("#commandDiv").off();e=b;c(e)});window.isBrowser&&nativeCallback("");a.getUserJson()},D=function(a){var c=a.callback,e=0;if(b.hasModel("charaList"))c();else{var d=["CharaCollection","PieceCollection","DoppelCollection","EnemyCollection"],
g=function(a){a=a.apiNum;return window.isLocal?"/magica/json/page/"+d[a]+".json":"/magica/api/page/"+d[a]},p=function(a){f.ajaxSimpleGet(g({apiNum:a.apiNum}),"",function(a){b.responseSetStorage(a);e++;e==d.length?c():p({apiNum:e})})};p({apiNum:e})}},B=function(e){var c=e.pageJson;e.userData||(k.each(["charaList","userPieceCollectionList","doppelList","enemyList","userEnemyList"],function(a,e,d){c[a]=b.storage[a].toJSON()}),a.setUserJson(c))};return{needModelIdObj:[{id:"user"},{id:"gameUser"},{id:"userItemList"},
{id:"userStatusList"},{id:"userCharaList"},{id:"userCardList"},{id:"pieceList"},{id:"userPieceList"},{id:"userPieceSetList"},{id:"userPieceArchiveList"},{id:"userDeckList"},{id:"userLive2dList"},{id:"userDoppelList"},{id:"userCharaEnhancementCellList"}],fetch:function(){var e=this;b.displayedTop||a.setWebView(!1);a.stopMemoriaTop();a.endQuest();a.endArena();a.endL2d();a.hideMiniChara();a.hideMultiMiniChara();a.popEventBranch();a.hideSubQuestBg();a.popEventSingleRaid();a.deleteEventWitchExchangeAnime();
a.popEventStoryRaid();a.callTouchesClear();a.weekQuestTopUnset();a.stopComposeEffect();a.turnOffCamera();a.stopNormalGachaMemoria();a.formationPreviewRemove();a.enemyFormationPreviewRemove();a.endGachaAnimation();a.endPlayMovie();a.hideEventDungeon();a.hideEventRaid();a.popEmotionBoard();a.deletePuellaHistoriaObject();a.deleteScene0StorySelectObject();a.deleteScene0StoryListObject();var c=function(c){if(n=c)f.ApiPageAccessCallback(n);else if(console.log("サーバー通信可能"),window.g_sns&&window.app_ver||window.isBrowser)f.pageModelGet(e.needModelIdObj);
else{var d=0,g=function(){d++;3<d?(b.androidKeyStop=!0,a.setWebView(),new b.PopupClass({title:"通信エラー",popupId:"resultCodeError",content:"通信環境の良い所で再度お試しください。",decideBtnText:"リロード",canClose:!1},null,function(){b.tapBlock(!1);b.forceTapBlock({isBlock:!1});b.loading.hide();$("#resultCodeError .decideBtn").on(b.cgti,function(b){$("#resultCodeError .decideBtn").off();a.nativeReload("#/TopPage");window.isDebug&&window.isBrowser&&(location.href="#/TopPage",location.reload())})})):window.g_sns&&window.app_ver?
f.pageModelGet(e.needModelIdObj):setTimeout(g,500)};setTimeout(g,500)}};b.hasModel("gameUser")?f.pageModelGet(this.needModelIdObj,null,"noConnect"):C({callback:c})},init:function(){d=f.getPageJson();var e=function(){"undefined"!==typeof d.gameUser&&a.setUserId(d.gameUser.userId);var c=window.deleteAssetArr(),e=function(){"undefined"!==typeof d.gameUser?z():($("#commandDiv").on("nativeCallback",function(a,b){$("#commandDiv").off();l()}),a.startTop())},f=function(){$("#commandDiv").on("nativeCallback",
function(b,d){$("#commandDiv").off();d.isExist?($("#commandDiv").on("nativeCallback",function(a,b){$("#commandDiv").off();c.shift();0<c.length?f():e()}),b=6E4*((new Date).getTime()/6E4|0),require(["text!"+c[0].jsonFilePath+"?bust\x3d"+b],function(b){b=JSON.parse(b);a.removeFile(b.list)})):(c.shift(),0<c.length?f():e())});a.existFile(c[0].confirmFileNames)};window.isBrowser?l():0<c.length&&!b.displayedTop?f():e()};d&&d.gameUser?D({callback:e}):e()},remove:function(b){m&&m.remove();a.endTop();b()}}});